#!/usr/local/bin/python3

import requests
import json
import hashlib

THING = "0x608060405234801561001057600080fd5b50600436106100cf5760003560e01c8063395093511161008c57806395d89b411161006657806395d89b4114610226578063a457c2d714610244578063a9059cbb14610274578063dd62ed3e146102a4576100cf565b806339509351146101aa57806370a08231146101da578063711d03ce1461020a576100cf565b806306fdde03146100d4578063095ea7b3146100f257806318160ddd1461012257806323b872dd1461014057806328231bf214610170578063313ce5671461018c575b600080fd5b6100dc6102d4565b6040516100e991906111ed565b60405180910390f35b61010c60048036038101906101079190610ff5565b610366565b60405161011991906111d2565b60405180910390f35b61012a610384565b604051610137919061132f565b60405180910390f35b61015a60048036038101906101559190610fa6565b61038e565b60405161016791906111d2565b60405180910390f35b61018a60048036038101906101859190610ff5565b61048f565b005b61019461052d565b6040516101a1919061134a565b60405180910390f35b6101c460048036038101906101bf9190610ff5565b610536565b6040516101d191906111d2565b60405180910390f35b6101f460048036038101906101ef9190610f41565b6105e2565b604051610201919061132f565b60405180910390f35b610224600480360381019061021f9190610f41565b61062a565b005b61022e610741565b60405161023b91906111ed565b60405180910390f35b61025e60048036038101906102599190610ff5565b6107d3565b60405161026b91906111d2565b60405180910390f35b61028e60048036038101906102899190610ff5565b6108c7565b60405161029b91906111d2565b60405180910390f35b6102be60048036038101906102b99190610f6a565b6108e5565b6040516102cb919061132f565b60405180910390f35b6060600380546102e390611493565b80601f016020809104026020016040519081016040528092919081815260200182805461030f90611493565b801561035c5780601f106103315761010080835404028352916020019161035c565b820191906000526020600020905b81548152906001019060200180831161033f57829003601f168201915b5050505050905090565b600061037a61037361096c565b8484610974565b6001905092915050565b6000600254905090565b600061039b848484610b3f565b6000600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006103e661096c565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905082811015610466576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161045d9061128f565b60405180910390fd5b6104838561047261096c565b858461047e91906113d7565b610974565b60019150509392505050565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461051f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105169061126f565b60405180910390fd5b6105298282610dbe565b5050565b60006012905090565b60006105d861054361096c565b84846001600061055161096c565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546105d39190611381565b610974565b6001905092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106ba576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106b19061126f565b60405180910390fd5b80600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff167fdacf3394e265c5a9b5a0b8b7f9c64619dd468f6abe1fc900bd429e6a8700bed960405160405180910390a250565b60606004805461075090611493565b80601f016020809104026020016040519081016040528092919081815260200182805461077c90611493565b80156107c95780601f1061079e576101008083540402835291602001916107c9565b820191906000526020600020905b8154815290600101906020018083116107ac57829003601f168201915b5050505050905090565b600080600160006107e261096c565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffff"
URL = {
    "mainnet": "https://mainnet.infura.io/v3/dfac3d264bdf41cc8b6cc5e81b343979",
    "roppy": "https://ropsten.infura.io/v3/dfac3d264bdf41cc8b6cc5e81b343979",
}

ADDRESSES = [
    # mainnet
    "0xcB84d72e61e383767C4DFEb2d8ff7f4FB89abc6e",
    "0x23d1bFE8fA50a167816fBD79D7932577c06011f4",
    "0x195064D33f09e0c42cF98E665D9506e0dC17de68",
    "0xCd403f722b76366f7d609842C589906ca051310f",

    #testnet
    "0xF0598Cd16FA3bf4c34052923cBE2D34028da0c69",
    "0x0614188938f5C3bD8461D4B413A39eeC2C5f42D9",
    "0xfce2CC92203A266a9C8e67461ae5067c78f67235",
]

def getcode(url, address):

    data = {
        "jsonrpc":"2.0",
        "method":"eth_getCode",
        "params": [
            address, "latest",
        ],
        "id": 1,

    }
    r = requests.post(url, json=data)
    if not r.ok:
        return None

    res = r.json()['result']
    return None if res == '0x' else res.strip()


def as_hash(to_hash):
    m = hashlib.sha3_256()
    m.update(bytes.fromhex(to_hash[2:]))
    return m.digest().hex()

def main():
    #url = URL['mainnet-infura']
    url = URL['mainnet']

    print( "var contractHashes = map[string]string{")
    to_json = dict()
    for addr in ADDRESSES:

        code = getcode(url, addr)
        if code is  None:
            continue
        
        
        to_json[addr] = as_hash(code)
        print(f'"{addr}":"{to_json[addr]}",')

    output = {
        "hashes": to_json
    }

    print("}")

    with open('contract-hashes.json', 'w') as outfile:
        json.dump(output, outfile)
    


if __name__ == "__main__":
    main()